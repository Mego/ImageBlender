var grouper=function(n,r,e){for(var t=n.length%r,o=[];t;)n.push(e),t--;for(;n.length;){for(elem=[];elem.length<r;)elem.push(n.pop());elem.reverse(),o.push(elem)}return o.reverse(),o},flatten=function(n){var r=[];for(var e in n)n[e]instanceof Array?r.push(flatten(n[e])):r.push([n[e]]);return r.reduce(function(n,r){return n.concat(r)})},pnm_to_bin=function(n){var r=parseInt(n[1].split(" ")[0]),e=(parseInt(n[1].split(" ")[1]),n.slice(3).join(" ").replace("\n"," ").split(/\s+/g)),t=[];e=e.filter(function(n){return n.length}).map(function(n){return parseInt(n)});for(var o=grouper(e,3*r),u=0;u<o.length;){for(var i=grouper(o[u],3),a=[],p=0;p<i.length;)a.push(i[p]),p++;t.push(a),u++}return t},bin_to_pnm=function(n){return pnm="P3 "+n[0].length+" "+n.length+" 255 ",n=flatten(n),pnm+=n.map(function(n){return n.toString()}).join(" "),pnm},imageblender=function(n){for(var r=(new Array).concat(n),e=r.length,t=r[0].length,o=0;t>o;){for(var u=0;e>u;){for(var i=0;3>i;){var a=Math.floor((n[u][o][i]+n[u][t+~o][i]+n[e+~u][o][i]+n[e+~u][t+~o][i])/4);r[u][o][i]=a,r[u][t+~o][i]=a,r[e+~u][o][i]=a,r[e+~u][t+~o][i]=a,i++}u++}o++}return r},main=function(n){return b=pnm_to_bin(n.split("\n")),bin=imageblender(b),bin_to_pnm(bin)};